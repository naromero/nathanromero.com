<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<!-- <meta http-equiv="refresh" content="120" /> -->
		<meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0" name="viewport">
		<title>Hack Day</title>
		
		<link rel="stylesheet" href="css/reset.css" />
		<link rel="stylesheet" href="css/style.css" />
		<script src="//code.jquery.com/jquery-1.10.1.min.js"></script>
		<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600' rel='stylesheet' type='text/css'>
		<script src="js/jquery.simpleWeather.js"></script>
		<script>
			$.simpleWeather({
				zipcode: '94108',
				woeid: '12797159',
				location: 'San Francisco',
				unit: 'f',
				success: function(weather) {
					html = '<h5>'+weather.city+', '+weather.region+'</h5>';
					html += '<p class="temp">'+weather.temp+'&deg;</p>';
					html += '<span class="tempdesc">'+weather.currently+'</span>';			
					$("#weather").html(html);
				},
				error: function(error) {
					$("#weather").html('<p>'+error+'</p>');
				}
			});		
		</script>
		
		<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
		    <script>
			var geocoder;
			var map;
			function initialize() {
			  geocoder = new google.maps.Geocoder();
			  var latlng = new google.maps.LatLng(-34.397, 150.644);
			  var mapOptions = {
			    zoom: 16,
			    center: latlng,
				disableDefaultUI: true,
				navigationControl: false,
				mapTypeControl: false,
				streetViewControl: false,
			    mapTypeId: google.maps.MapTypeId.ROADMAP
			  }
			  map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
			  codeAddress();
			}
			
			function codeAddress() {
			  var address = $(".address").data("address");
			  geocoder.geocode( { 'address': address}, function(results, status) {
			    if (status == google.maps.GeocoderStatus.OK) {
			      map.setCenter(results[0].geometry.location);
			      var marker = new google.maps.Marker({
			          map: map,
			          position: results[0].geometry.location
			      });
			    } else {
			      //alert('Geocode was not successful for the following reason: ' + status);
			    }
			  });
			}
			
			google.maps.event.addDomListener(window, 'load', initialize);

    </script>


		
		
		<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	    <script type="text/javascript">
	    
	      // Load the Visualization API and the piechart package.
	      google.load('visualization', '1.0', {'packages':['corechart']});
	      
	      // Set a callback to run when the Google Visualization API is loaded.
	      google.setOnLoadCallback(drawChart);
	
	
	      // Callback that creates and populates a data table, 
	      // instantiates the pie chart, passes in the data and
	      // draws it.
	      function drawChart() {
	
	      // Create the data table.
	      var data = new google.visualization.DataTable();
	      data.addColumn('string', 'Topping');
	      data.addColumn('number', 'Slices');
	      data.addRows([
	        ["Thu 6-6", 1464],
	        ["Fri 6-7", 1339], 
	        ["Sat 6-8", 586], 
	        ["Sun 6-9", 521], 
	        ["Mon 6-10", 1672], 
	        ["Tue 6-11", 1544], 
	        ["Wed 6-12", 1327]
	
	      ]);
	
	      // Set chart options
	      var options = {'title':'How Much Pizza I Ate Last Night',
	                     'width':300,
	                     'height':300};
	
	      // Instantiate and draw our chart, passing in some options.
	      var chart = new google.visualization.BarChart(document.getElementById('chart_div'));
	      chart.draw(data, options);
	    }
	    </script>
	    
		<script src="js/jquery.instagram.js"></script>
		<script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/oauth.js"></script>
		<script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/sha1.js"></script>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"></script>
		<script type="text/javascript">
		var auth = { 
		  //
		  // Update with your auth tokens.
		  //
		  consumerKey: "S8oQlyMqBX9iHJ56ZgkZ-Q", 
		  consumerSecret: "Vp-NSBL8QpGPRH_F37uSMoHLVXc",
		  accessToken: "OMuCBNCAscgAuVK-Nzd_sQS6pM6RFQgy",
		  // This example is a proof of concept, for how to use the Yelp v2 API with javascript.
		  // You wouldn't actually want to expose your access token secret like this in a real application.
		  accessTokenSecret: "3oKLM3f5GM5KZ2rKUHSzsK7FtEo",
		  serviceProvider: { 
		    signatureMethod: "HMAC-SHA1"
		  }
		};
		
		var terms = 'food';
		var near = '650+California+st+San+Francisco';
		
		var accessor = {
		  consumerSecret: auth.consumerSecret,
		  tokenSecret: auth.accessTokenSecret
		};
		
		parameters = [];
		parameters.push(['term', terms]);
		parameters.push(['location', near]);
		parameters.push(['callback', 'cb']);
		parameters.push(['oauth_consumer_key', auth.consumerKey]);
		parameters.push(['oauth_consumer_secret', auth.consumerSecret]);
		parameters.push(['oauth_token', auth.accessToken]);
		parameters.push(['oauth_signature_method', 'HMAC-SHA1']);
		
		var message = { 
		  'action': 'http://api.yelp.com/v2/search',
		  'method': 'GET',
		  'parameters': parameters 
		};
		
		OAuth.setTimestampAndNonce(message);
		OAuth.SignatureMethod.sign(message, accessor);
		
		var parameterMap = OAuth.getParameterMap(message.parameters);
		parameterMap.oauth_signature = OAuth.percentEncode(parameterMap.oauth_signature)
		console.log(parameterMap);
		
		$.ajax({
		  'url': message.action,
		  'data': parameterMap,
		  'cache': true,
		  'dataType': 'jsonp',
		  'jsonpCallback': 'cb',
		  'success': function(data, textStats, XMLHttpRequest) {
		    console.log(data);
		    render(data);
		  }
		});
		</script>
				
	</head>
	<body>
		<div class="container">
			<div class="photoFeed">
				<h3 class="title instagramIcon">#AppDirect</h3>	
				<div class="instagram"></div>
			</div>
			<div class="sidebar">
				<div id="yelp" class="sideelement">
					<h3 class="title yelpIcon">Dartboard</h3>
					<div class="yelp-container">
					  <div class="yelp-display"></div>
					  <script class="template" type="underscore/template">
						  <div data-rating="<%- business.rating %>" class="restaurant">
						    <h5><%- business.name %></h5>
						    <div class="rating">
							    <img src="<%- business.rating_img_url_large %>" />
							    <span id="metaInfo">(<%- business.review_count %>)</span>
						    </div>
						    <!-- <img class="image_url" src="<%- business.image_url %>" /> -->
						    <div class="address" data-address="<%- business.location.address[0] + business.location.city %>"><% var displayAddress = business.location.display_address %>
						      <% if(displayAddress) { %>
						      <span><%- displayAddress[0] %></span>,
						      <div class="hide"><%- displayAddress[1] %></div>
						      <span><%- displayAddress[2] %></span>
						      <% } %>
						    </div>
						  </div>
						</script>
						<div id="map-canvas"></div>
						<!--
<script>
							var map;
							function initialize() {
							  var mapOptions = {
							    zoom: 8,
							    center: new google.maps.LatLng(-34.397, 150.644),
							    mapTypeId: google.maps.MapTypeId.ROADMAP
							  };
							  map = new google.maps.Map(document.getElementById('map-canvas'),
							      mapOptions);
							}
							
							google.maps.event.addDomListener(window, 'load', initialize);
						</script>
-->
						</html>
				</div>
				</div>
				<h3 class="title weatherIcon">Weather</h3>
				<div id="weather"></div>
				<div id="twitter" class="sideelement">
					<h3 class="title twitterIcon">Twitter</h3>
					<a class="twitter-timeline" data-dnt="true" data-chrome="noborders" href="https://twitter.com/AppDirect" data-widget-id="344936251712999425">Tweets by @AppDirect</a>
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
	
				</div>
				<!--<div id="data">
					<h3>Data</h3>
					<div id="chart_div" style="width:100%; height:300"></div>

				</div>
				<div id="music">
					<h3>Music</h3>
				</div> -->
			</div>
		</div>
	</body>
	<script>
				 $(function() {
		  $(".instagram").instagram({
		      hash: 'appdirect'
		    , clientId: 'd67fa496a26844c5a4b57d3cb2ed7561'
		    , image_size: 'low_resolution'
		    , show: '20'
		  });
		});
	</script>
				
				<script type="text/javascript">
				  $(function() {
				    var template = $(".template").text()
				    render = function(data) {
				      var businesses = data.businesses;
				      var lucky = Math.floor(Math.random()*data.businesses.length);
				      var asishDAAAAAASH = businesses[lucky];
				      var html = _.template(template, {business: asishDAAAAAASH});
				      $(".yelp-display").html(html);
				      if(window.geocoder) {
				      	codeAddress();
				      	}
				      }
				  });
				</script>
</html>